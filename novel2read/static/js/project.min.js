!function(){let t;let e="/"!==location.pathname,a="/"!==location.pathname;$(".infinite-container").infiniteScroll({path:".infinite-more-link",append:".infinite-item",button:".infinite-more-link",scrollThreshold:e,status:".loading",history:a});$("select").selectize({}),$(".selectize-input > input").prop("disabled","disabled");let o=(window.innerWidth,"auto"),n=window.innerWidth>2020?300:500;new Swiper(".swiper-container",{navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},autoplay:{delay:7e3,disableOnInteraction:!0},roundLengths:!0,centeredSlides:!0,loop:!0,slidesPerView:o,effect:"coverflow",coverflowEffect:{rotate:0,stretch:0,depth:n,modifier:1,slideShadows:!1},slideToClickedSlide:!0});function i(t="",e="info"){document.body;let a=document.getElementsByClassName("container")[1],o=document.createElement("div");o.className=`alert alert-${e}`,o.textContent=t,a.appendChild(o),setTimeout(()=>{o.classList.add("animate")},100),setTimeout(()=>{o.classList.remove("animate")},1800),setTimeout(()=>{a.removeChild(o)},2e3)}$(".swiper-container").animate({opacity:1},150),$(".js-toggle-next").on("click",function(){$(this).next().toggle()}),$(".tags-dropdown").on("click",function(){$(".js-tags-nav").slideToggle(300)}),$(".filters-dropdown").on("click",function(){$(".js-filter-form").slideToggle(300)}),$(".js-filter-form").change(function(){$(this).submit()}),$(".js-tag-filter li").each(function(){$(this).attr("data-search-term",$(this).text().toLowerCase())}),$(".js-tag-input").on("keyup",function(){var t=$(this).val().toLowerCase();$(".js-tag-filter li").each(function(){$(this).filter("[data-search-term *= "+t+"]").length>0||t.length<1?$(this).show():$(this).hide()})});let s=$("[name=csrfmiddlewaretoken]").val(),r=s||function(t){var e=null;if(document.cookie&&""!==document.cookie)for(var a=document.cookie.split(";"),o=0;o<a.length;o++){var n=jQuery.trim(a[o]);if(n.substring(0,t.length+1)===t+"="){e=decodeURIComponent(n.substring(t.length+1));break}}return e}("csrftoken");function l(t){let e={lib_in:t.attr("data-lib-in")};$.ajax({url:t.attr("data-lib-url"),type:"post",dataType:"json",data:e,success:function(e){e.is_valid?e.in_lib?(t[0].hasAttribute("data-bookmark")?(t.html('<i class="far fa-bookmark"></i>'),i("Book removed from Library.")):t[0].hasAttribute("data-lib-remonly")?t.parents()[3].remove():t.html("Add to Library"),t.attr("data-lib-in",0)):(t[0].hasAttribute("data-bookmark")?(t.html('<i class="fas fa-bookmark"></i>'),i("Book added to Library.")):t.html('<i class="fas fa-check"></i> In Library'),t.attr("data-lib-in",1)):i(e.info_msg,"warning")},error:function(t,e,a){i(`${t.status} ${t.statusText}`,"error")}})}$.ajaxSetup({beforeSend:function(t,e){var a;a=e.type,/^(GET|HEAD|OPTIONS|TRACE)$/.test(a)||this.crossDomain||t.setRequestHeader("X-CSRFToken",r)}}),$(".js-theme").click(function(){let e=$(this);t=setTimeout(function(){!function(t){data={};let e=t.attr("data-theme-color"),a=t.attr("data-theme-font"),o=t.attr("data-theme-fz"),n=t.attr("data-theme-lh");e&&(data.tm_color=e),a&&(data.tm_font=a),o&&(data.tm_fz=o),n&&(data.tm_lh=n),$.ajax({url:t.attr("data-theme-url"),type:"post",dataType:"json",data:data,success:function(t){},error:function(t,e,a){i(`${t.status} ${t.statusText}`,"error")}})}(e)},200)}),$(document).on("click",".js-vote-btn",function(){let e=$(this);t=setTimeout(function(){!function(t){$.ajax({url:t.attr("data-vote-url"),type:"post",dataType:"json",success:function(e){e.is_valid?(t.parent().parent().find(".js-bvotes").html(e.book_votes),$(".js-uvotes").html(e.user_votes)):i(e.info_msg,"warning")},error:function(t,e,a){i(`${t.status} ${t.statusText}`,"error")}})}(e)},200)}),$(document).on("click",".js-lib-btn",function(){clearTimeout(t);let e=$(this);t=setTimeout(function(){if(e[0].hasAttribute("data-lib-remonly")){if(!confirm("Are you sure you want to remove this book?"))return!1;l(e)}l(e)},200)}),$("#search-form").on("change paste keyup",function(e){e.preventDefault(),clearTimeout(t);let a=$(this);return $("#id_search_field").val()&&(t=setTimeout(function(){!function(t){$.ajax({url:t.attr("action"),type:"post",dataType:"json",data:{search_field:$("#id_search_field").val()},success:function(t){$(".booksearch__formresult").html(t.html_search_form_result)},error:function(t,e,a){i(`${t.status} ${t.statusText}`,"error")}})}(a)},250)),!1});let c=localStorage.getItem("chap_scroll",0),d=localStorage.getItem("chap_url",""),u=localStorage.getItem("pos-list");function m(t){let e=document.body.classList;t.includes("color")&&((e.contains("tm-color-light")||e.contains("tm-color-dark"))&&e.remove("tm-color-light","tm-color-dark"),e.add(t)),t.includes("font")&&((e.contains("tm-font-arial")||e.contains("tm-font-lora")||e.contains("tm-font-roboto"))&&e.remove("tm-font-arial","tm-font-lora","tm-font-roboto"),e.add(t)),t.includes("fz")&&((e.contains("tm-fz-18")||e.contains("tm-fz-17")||e.contains("tm-fz-16")||e.contains("tm-fz-15")||e.contains("tm-fz-14"))&&e.remove("tm-fz-18","tm-fz-17","tm-fz-16","tm-fz-15","tm-fz-14"),e.add(t)),t.includes("lh")&&((e.contains("tm-lh-20")||e.contains("tm-lh-15")||e.contains("tm-lh-10")||e.contains("tm-lh-5"))&&e.remove("tm-lh-20","tm-lh-15","tm-lh-10","tm-lh-5"),e.add(t))}u=null!==u?u:localStorage.setItem("pos-list",[]),window.onscroll=(()=>{let t=window.pageYOffset;localStorage.setItem("chap_scroll",t),localStorage.setItem("chap_url",location.pathname)}),d===location.pathname&&window.scrollTo({top:c,left:0,behavior:"auto"});const f=document.body.querySelector(".chap-styles"),h=document.getElementById("stylesMenu"),g=document.getElementById("stylesBtn");f.addEventListener("click",function(t){const e=t.target.getAttribute("data-theme-color"),a=t.target.getAttribute("data-theme-font"),o=t.target.getAttribute("data-theme-fz"),n=t.target.getAttribute("data-theme-lh");t.target===g&&h.classList.toggle("visible"),e&&m(e),a&&m(a),o&&m(o),n&&m(n)},!1),$("#chaps-toggle")[0].addEventListener("click",function(t){let e=$(this);e.next()[0].classList.toggle("visible"),function(t){if(+t.attr("data-loaded"))return!1;$.ajax({url:t.attr("data-url-chaps"),type:"get",dataType:"json",success:function(e){t.next().html(e.html_chaps),t.attr("data-loaded",1),document.getElementById("activeChap").scrollIntoView(!1)},error:function(t,e,a){i(`${t.status} ${t.statusText}`,"error")}})}(e)}),document.body.addEventListener("click",function(t){let e=$("#chaps-nav")[0],a=$("#chaps-toggle")[0];e.classList.contains("visible")&&(t.target===a||$(t.target).closest(e).length||e.classList.remove("visible")),h.classList.contains("visible")&&(t.target===g||$(t.target).closest(h).length||h.classList.remove("visible"))},!1)}();